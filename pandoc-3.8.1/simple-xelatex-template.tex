\documentclass[12pt,a4paper]{article}

% --- Fonts & Sprache (XeLaTeX) ---
\usepackage{fontspec}
\usepackage{polyglossia}
\setmainlanguage{german}
$if(mainfont)$
\setmainfont{$mainfont$}[Ligatures=TeX]
$else$
\setmainfont{Latin Modern Roman}[Ligatures=TeX]
$endif$
$if(sansfont)$
\setsansfont{$sansfont$}[Ligatures=TeX]
$else$
\setsansfont{Latin Modern Sans}[Ligatures=TeX]
$endif$
$if(monofont)$
\setmonofont{$monofont$}[Ligatures=TeX]
$else$
\setmonofont{Latin Modern Mono}[Ligatures=TeX]
$endif$

% --- Layout ---
\usepackage{geometry}
\geometry{margin=2.5cm}
\usepackage{setspace}
\setstretch{1.2}

% --- Text-Formatierung ---
\usepackage[normalem]{ulem}  % Für \sout (durchgestrichener Text) - normalem verhindert Überschreibung von \emph
\usepackage{soul}  % Für \hl (Hervorhebungen)
\usepackage{graphicx}  % Für Bilder


% --- Überschriften ---
\usepackage{titlesec}
\titleformat{\section}{\normalfont\Large\bfseries}{}{0em}{}
\titleformat{\subsection}{\normalfont\large\bfseries}{}{0em}{}

% --- Nummerierung komplett deaktivieren ---
\setcounter{secnumdepth}{0}  % Keine Nummerierung für Sections, Subsections, etc.

% --- Seitenumbruch vor Kapiteln (Sections) ---
\newcommand{\sectionbreak}{\clearpage}
\usepackage{etoolbox}
\makeatletter
\patchcmd{\section}{\if@noskipsec}{\if@noskipsec\clearpage}{}{}
\makeatother

% --- Initialen (Drop Caps) Styling ---
\usepackage{lettrine}
% Grundstil für alle Initialen (vom Lua-Filter gesetzt)
\renewcommand{\LettrineTextFont}{\bfseries\color{black}}
\renewcommand{\LettrineFont}{\fontsize{48}{48}\selectfont\bfseries} % etwas kleiner
\setlength{\DefaultNindent}{0.3em}   % linker Einzug
\setlength{\DefaultFindent}{0.2em}   % Abstand Initiale/Text
\setcounter{DefaultLines}{3}         % über 3 Zeilen
\renewcommand{\DefaultLraise}{0.2}   % leicht angehoben
\renewcommand{\DefaultLoversize}{0.12} % etwas kompakter

% --- Pandoc-kompatible Pakete ---
\usepackage{longtable,booktabs,array,calc,colortbl,multirow,hhline,ifthen,ltxtable}
\usepackage{graphicx,grffile,textcomp,amsmath,amssymb,url,listings,fancyvrb,footnote,parskip}

% --- Links ---
\usepackage{hyperref}
\hypersetup{colorlinks=true, linkcolor=black, urlcolor=blue}

% --- Pandoc-spezifische Befehle ---
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
% Pandoc-Befehl für begrenzte Bilder
% \pandocbounded wird mit einem Argument aufgerufen, das bereits \includegraphics enthält
% Beispiel: \pandocbounded{\includegraphics[keepaspectratio]{bild.png}}
% Zentriere das Bild ohne Seitenumbrüche
\newcommand{\pandocbounded}[1]{%
  \par
  \nopagebreak
  \begin{center}%
  #1%
  \end{center}%
  \nopagebreak
  \par
}
% Zentriere alle includegraphics-Befehle im Text
% Verhindere Seitenumbrüche vor und nach Bildern
\makeatletter
\let\oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[2][]{%
  \par
  \nopagebreak
  \begin{center}%
  \oldincludegraphics[#1]{#2}%
  \end{center}%
  \nopagebreak
  \par
}
\makeatother

% --- Inhaltsverzeichnis ohne Nummern ---
\makeatletter
\renewcommand{\@seccntformat}[1]{}
\makeatother

% --- Inhaltsverzeichnis: H1 und H2 anzeigen ---
% tocdepth=2 bedeutet H1 (sections) und H2 (subsections)
\setcounter{tocdepth}{2}

\begin{document}

% --- Cover-Bild (eigene Seite) ---
$if(cover-image)$
\begin{titlepage}
  \centering
  \vspace*{\fill}
  \includegraphics[width=0.6\textwidth,keepaspectratio]{$cover-image$}
  \vspace*{\fill}
\end{titlepage}
\newpage
$endif$

% --- Titelseite ---
\begin{titlepage}
  \centering
  \vspace*{3cm}
  {\Huge \bfseries $title$ \par}
  $if(subtitle)$
  \vspace{0.8cm}
  {\Large \textit{$subtitle$} \par}
  $endif$
  \vspace{2cm}
  {\Large $author$ \par}
  \vspace{1cm}
  {\large $date$ \par}
  $if(rights)$
  \vspace{1.5cm}
  {\small $rights$ \par}
  $endif$
  \vfill
\end{titlepage}

% --- Abstract ---
\newpage
\begin{abstract}
\noindent\textbf{Zusammenfassung}\\[0.5em]
$abstract$
\end{abstract}

% --- Inhaltsverzeichnis ---
\newpage
\tableofcontents
\newpage

% --- Inhalt ---
$body$

\end{document}
